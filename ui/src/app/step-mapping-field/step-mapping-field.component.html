<div class='selection'>
  <i class="fas fa-caret-right" [class.open]='more' (click)='more = !more'></i>
  <label class='main'>{{mapping.name}}</label>
  <i class='fa fa-arrow-right'></i>
  <select *ngIf='!mapping.compound'
          class='ct-selector'
          [value]='mapping.columnType'
          (change)='updateMapping($event.target.value); changed()'>
    <option [value]='null'>-</option>
    <option *ngFor='let ct of taxonomy.columnTypes'
            [value]='ct.name'>{{ct.title}}
    </option>
  </select>
  <select *ngIf='mapping.compound'
          class='ct-selector'
          [value]='mapping.normalizeTarget'
          (change)='mapping.normalizeTarget = $event.target.value; changed()'>
    <option [value]='null'>-</option>
    <option *ngFor='let ct of taxonomy.columnTypes'
            [value]='ct.name'>{{ct.title}}
    </option>
  </select>
</div>
<div class='description' *ngIf='mapping.description && !mapping.compound'>
  {{ mapping.description }}
</div>
<div class='compound-mapping' *ngIf='mapping.compound'>
  <span class='for' i18n>for</span>
  <app-extendable-keyvalue-list
    [taxonomy]='taxonomy'
    [data]='mapping.normalize || {}'
    (update)='mapping.normalize = $event; changed()'
  ></app-extendable-keyvalue-list>
</div>
<div class='more' *ngIf='more'>
  <div class='formish'>
    <label i18n>Title:</label>
    <input [(ngModel)]='mapping.title' type='text'>
  </div>
  <ng-container *ngIf='ct.dataType === "date"'>
    <div class='formish'>
      <label i18n>Date Format:</label>
      <ng-container *ngIf='api.currentConfig.dateFormats && api.currentConfig.dateFormats.length > 0'>
        <select [(ngModel)]='mapping.options.format'>
          <option [value]='df.format' *ngFor='let df of api.currentConfig.dateFormats'>{{df.display}}</option>
        </select>
        <span i18n>Custom Format:</span>
      </ng-container>
      <input [(ngModel)]='mapping.options.format' type='text'>
    </div>
  </ng-container>
  <ng-container *ngIf='ct.dataType === "boolean"'>
    <div class='formish'>
      <label i18n>True Values:</label>
      <input [(ngModel)]='mapping.options.trueValues' type='text'>
    </div>
    <div class='formish'>
      <label i18n>False Values:</label>
      <input [(ngModel)]='mapping.options.falseValues' type='text'>
    </div>
  </ng-container>
  <a class='toggle-compound' (click)='mapping.compound=true' i18n *ngIf='!mapping.compound'>Change to compound mapping</a>
  <a class='toggle-compound' (click)='mapping.compound=false' i18n *ngIf='mapping.compound'>Change to simple mapping</a>
</div>